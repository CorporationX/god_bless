package school.faang.BJS2_56994;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class LibrarySystem {
    private static final Map<Book, String> bookShelfMap = new ConcurrentHashMap<>();

    // Formatting Constants
    private static final String HEADER = "üìö –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:";
    private static final String TABLE_BORDER =
            "------------------------------------------------------------------------------";
    private static final String TABLE_HEADER = "| %-35s | %-20s | %-6s | %-10s |%n";
    private static final String TABLE_ROW = "| %-35s | %-20s | %-6d | %-10s |%n";
    private static final String EMPTY_LIBRARY_MESSAGE = "üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞! –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–Ω–∏–≥.";
    private static final String BOOK_NOT_FOUND_MESSAGE = "–ö–Ω–∏–≥–∞ —Å —Ç–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.";
    private static final String BOOK_LOCATION_MESSAGE = "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–∏–≥–∏: %s%n";
    private static final String THROW_ADDBOOK_MESSAGE_TEXT =
            "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã title, author –∏ location –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å null –∏–ª–∏ –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏";
    private static final String THROW_ADDBOOK_MESSAGE_YEAR = "–ì–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–µ—Ç—ã—Ä—ë—Ö–∑–Ω–∞—á–Ω—ã–º —á–∏—Å–ª–æ–º.";

    private static Map<Book, String> getBookShelfMap() {
        return bookShelfMap;
    }

    public static void addBook(String title, String author, int year, String location) {
        if (title == null || title.trim().isEmpty()
                || author == null || author.trim().isEmpty()
                || location == null || location.trim().isEmpty()) {
            throw new IllegalArgumentException(THROW_ADDBOOK_MESSAGE_TEXT);
        }

        if (year < 1000 || year > 9999) {
            throw new IllegalArgumentException(THROW_ADDBOOK_MESSAGE_YEAR);
        }

        Book newBook = new Book(title, author, year);
        bookShelfMap.put(newBook, location);
    }

    public static void removeBook(String title, String author, int year) {
        bookShelfMap.entrySet().removeIf(entry ->
                entry.getKey().getTitle().equals(title)
                        && entry.getKey().getAuthor().equals(author)
                        && entry.getKey().getYear() == year
        );
    }

    public static void findBook(String title, String author, int year) {
        for (Map.Entry<Book, String> entry : getBookShelfMap().entrySet()) {
            Book book = entry.getKey();
            if (book.getTitle().equals(title) && book.getAuthor().equals(author) && book.getYear() == year) {
                System.out.printf(BOOK_LOCATION_MESSAGE, entry.getValue());
                return;
            }
        }
        System.out.println(BOOK_NOT_FOUND_MESSAGE);
    }

    public static void printAllBooks() {
        if (getBookShelfMap().isEmpty()) {
            System.out.println(EMPTY_LIBRARY_MESSAGE);
            return;
        }

        System.out.println(HEADER);
        System.out.println(TABLE_BORDER);
        System.out.printf(TABLE_HEADER, "–ù–∞–∑–≤–∞–Ω–∏–µ", "–ê–≤—Ç–æ—Ä", "–ì–æ–¥", "–ü–æ–ª–∫–∞");
        System.out.println(TABLE_BORDER);

        getBookShelfMap().forEach((book, location) ->
                System.out.printf(TABLE_ROW, book.getTitle(), book.getAuthor(), book.getYear(), location)
        );

        System.out.println(TABLE_BORDER);
    }
}
