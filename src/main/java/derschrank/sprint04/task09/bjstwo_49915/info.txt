Fan out ‚Äì Fan In
derschrank2000-S04-T09-BJS2-49915
derschrank.sprint04.task09.bjstwo_49915

Sprint04. Task09. CompletableFuture. Fan out ‚Äì Fan In
----------------------
Fan out ‚Äì Fan In
üë©‚Äçüíª üß†üß† (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞)

–£—Å–ª–æ–≤–∏—è –∑–∞–¥–∞—á–∏
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–æ–∏—Ç –∑–∞–¥–∞—á–∞ –≤—ã—á–∏—Å–ª–∏—Ç—å —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ n, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–¥—Ö–æ–¥ Fan out ‚Äì Fan in. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–±–∏—Ç—å –±–æ–ª—å—à—É—é –∑–∞–¥–∞—á—É –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥–∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –∞ –∑–∞—Ç–µ–º —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ —Ü–µ–ª–æ–µ.

–¶–µ–ª—å:
–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ n —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. –î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º Fan out ‚Äì Fan in –∏ –∫–ª–∞—Å—Å–æ–º CompletableFuture –≤ Java.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1Ô∏è‚É£ –î–∞–Ω –∫–ª–∞—Å—Å SquareRequest, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç —á–∏—Å–ª–∞ –∏ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ—Ç 3 –¥–æ 4 —Å–µ–∫—É–Ω–¥):
public class SquareRequest {
    private static final long MIN_TIMEOUT = 3000L;
    private final Long number;

    public SquareRequest(Long number) {
        this.number = number;
    }

    public void longTimeSquare(ResultConsumer resultConsumer) {
        var randomTimeout = ThreadLocalRandom.current().nextInt(1000);
        try {
            Thread.sleep(MIN_TIMEOUT + randomTimeout);
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            resultConsumer.add(number * number);
        }
    }
}

2Ô∏è‚É£ –¢–∞–∫–∂–µ –µ—Å—Ç—å –∫–ª–∞—Å—Å ResultConsumer, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∏–ø–∞ AtomicLong –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤:
public class ResultConsumer {
    private final AtomicLong sumOfSquaredNumbers;

    ResultConsumer(Long init) {
        sumOfSquaredNumbers = new AtomicLong(init);
    }

    public Long add(final Long num) {
        return sumOfSquaredNumbers.addAndGet(num);
    }

    public Long getSum() {
        return sumOfSquaredNumbers.get();
    }
}

3Ô∏è‚É£ –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥:
public static Long fanOutFanIn(List<SquareRequest> requests, ResultConsumer resultConsumer)
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å n –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CompletableFuture, —á—Ç–æ–±—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∫–≤–∞–¥—Ä–∞—Ç—ã —á–∏—Å–µ–ª.

–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á

–í–µ—Ä–Ω–∏—Ç–µ –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ö—Ä–∞–Ω—è—â–∏–π—Å—è –≤ ResultConsumer.

4Ô∏è‚É£ –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ launch, –∫–æ—Ç–æ—Ä—ã–π:
–°–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑ 1000 –æ–±—ä–µ–∫—Ç–æ–≤ SquareRequest –¥–ª—è —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ 1000.

–ó–∞–ø—É—Å–∫–∞–µ—Ç –º–µ—Ç–æ–¥ fanOutFanIn –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª—å.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
public static void main(String[] args) {
    // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    launch();
}
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

–°—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ 1000: 333833500
–ü–æ—á–µ–º—É —ç—Ç–∞ –∑–∞–¥–∞—á–∞ –ø–æ–ª–µ–∑–Ω–∞?
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Fan out ‚Äì Fan in –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏, —É–ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –≤ —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –≥–¥–µ –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –í —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –∏–∑—É—á–∞—é—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –≤ Java, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –≤–∞–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ —Å –ø–æ–º–æ—â—å—é CompletableFuture.

–ù–µ–º–Ω–æ–≥–æ —Ç–µ–æ—Ä–∏–∏:
–ü–æ–¥—Ö–æ–¥ fan in - fan out –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏.

Fan out ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, —É –≤–∞—Å –µ—Å—Ç—å –±–æ–ª—å—à–∞—è –∑–∞–¥–∞—á–∞, –∏ –≤—ã –¥–µ–ª–∏—Ç–µ –µ—ë –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–¥–∑–∞–¥–∞—á, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

Fan in ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —ç—Ç–∏—Ö –º–µ–ª–∫–∏—Ö –∑–∞–¥–∞—á —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å, –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
----------------------
2:09:18: Executing ':derschrank.sprint04.task09.bjstwo_49915.Main.main()'‚Ä¶

> Task :compileJava
> Task :processResources NO-SOURCE
> Task :classes

> Task :derschrank.sprint04.task09.bjstwo_49915.Main.main()
 . calculating: 4
 . calculating: 7
 . calculating: 6
 . calculating: 5
 . calculating: 1
 . calculating: 2
 . calculating: 3
 . calculating: 8
 . calculating: 9
 . calculating: 10
 . calculating: 11
 . calculating: 12
 . calculating: 13
 . calculating: 14
 . calculating: 15
 . calculating: 16
 . calculating: 17
 . calculating: 18
 . calculating: 19
 . calculating: 20
 . calculating: 21
 . calculating: 22
 . calculating: 23
 . calculating: 24
 . calculating: 25
 . calculating: 26
 . calculating: 27
 . calculating: 28
 . calculating: 29
 . calculating: 30
 . calculating: 31
 . calculating: 32
 . calculating: 33
 . calculating: 34
 . calculating: 35
 . calculating: 36
 . calculating: 37
 . calculating: 38
 . calculating: 39
 . calculating: 40
 . calculating: 41
 . calculating: 42
 . calculating: 43
 . calculating: 44
 . calculating: 45
 . calculating: 46
 . calculating: 47
 . calculating: 48
 . calculating: 49
 . calculating: 50
 . calculating: 51
 . calculating: 52
 . calculating: 53
 . calculating: 54
 . calculating: 55
 . calculating: 56
 . calculating: 57
 . calculating: 58
 . calculating: 59
 . calculating: 60
 . calculating: 61
 . calculating: 62
 . calculating: 63
 . calculating: 64
 . calculating: 65
 . calculating: 66
 . calculating: 67
 . calculating: 68
 . calculating: 69
 . calculating: 70
 . calculating: 71
 . calculating: 72
 . calculating: 73
 . calculating: 74
 . calculating: 75
 . calculating: 76
 . calculating: 77
 . calculating: 78
 . calculating: 79
 . calculating: 80
 . calculating: 81
 . calculating: 82
 . calculating: 83
 . calculating: 84
 . calculating: 85
 . calculating: 86
 . calculating: 87
 . calculating: 88
 . calculating: 89
 . calculating: 90
 . calculating: 91
 . calculating: 92
 . calculating: 93
 . calculating: 94
 . calculating: 95
 . calculating: 96
 . calculating: 97
 . calculating: 98
 . calculating: 99
Sum of square of numbers from 1 to 99 is: 328350

BUILD SUCCESSFUL in 53s
2 actionable tasks: 2 executed
2:10:12: Execution finished ':derschrank.sprint04.task09.bjstwo_49915.Main.main()'.


 . calculating: 996
 . calculating: 997
 . calculating: 998
 . calculating: 999
Sum of square of numbers from 1 to 999 is: 332833500

BUILD SUCCESSFUL in 1m 28s
2 actionable tasks: 2 executed
2:15:23: Execution finished ':derschrank.sprint04.task09.bjstwo_49915.Main.main()'.
